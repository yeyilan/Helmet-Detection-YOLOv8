# **å®æ—¶ä¸ªäººé˜²æŠ¤è£…å¤‡(PPE)æ£€æµ‹ç³»ç»Ÿ (Real-time PPE Detection System)**

[![Python](https://img.shields.io/badge/Python-3.9-blue.svg)](https://www.python.org/) [![PyTorch](https://img.shields.io/badge/PyTorch-GPU-orange.svg)](https://pytorch.org/) [![YOLOv8](https://img.shields.io/badge/YOLO-v8-yellow.svg)](https://github.com/ultralytics/ultralytics)

è¿™æ˜¯ä¸€ä¸ªåŸºäº **YOLOv8** æ¡†æ¶çš„å®æ—¶ä¸ªäººé˜²æŠ¤è£…å¤‡ï¼ˆPPEï¼‰æ£€æµ‹é¡¹ç›®ã€‚é¡¹ç›®æ—¨åœ¨é€šè¿‡è®¡ç®—æœºè§†è§‰æŠ€æœ¯ï¼Œè‡ªåŠ¨è¯†åˆ«åœ¨å·¥åœ°ç­‰é«˜å±åœºæ™¯ä¸­ï¼Œäººå‘˜æ˜¯å¦æ­£ç¡®ä½©æˆ´å®‰å…¨å¸½ã€ç©¿ç€åå…‰è¡£ç­‰ï¼Œä»è€Œæå‡å®‰å…¨ç®¡ç†æ•ˆç‡ã€‚ æœ¬é¡¹ç›®æœ€å¤§çš„äº®ç‚¹ï¼Œåœ¨äºå®Œæ•´åœ°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ä¸€ä¸ªæ•°æ®é©±åŠ¨ã€ç§‘å­¦è¿­ä»£çš„ä¼˜åŒ–è¿‡ç¨‹ï¼Œå°†ä¸€ä¸ªåŸºå‡†æ¨¡å‹çš„mAP(50-95)ä»**0.21**ï¼Œä¸€æ­¥æ­¥åœ°ã€æ˜¾è‘—åœ°æå‡è‡³**0.55**çš„å“è¶Šæ°´å¹³ã€‚

---

## ğŸš€ æ•ˆæœå±•ç¤º (Demo) **æœ€ç»ˆV4.0æ¨¡å‹åœ¨å¤æ‚çœŸå®åœºæ™¯ä¸‹çš„æ£€æµ‹æ•ˆæœï¼š** ![æœ€ç»ˆæ•ˆæœå›¾1](docs/v4_prediction_1.jpg) ![æœ€ç»ˆæ•ˆæœå›¾2](docs/v4_prediction_2.jpg) 

---

## ğŸ“ˆ æ¨¡å‹è¿­ä»£ä¹‹è·¯ï¼šä»é’é“œåˆ°ç‹è€… (Model Iteration: From Bronze to King)

æœ¬é¡¹ç›®ç»å†äº†å››ä¸ªæ ¸å¿ƒç‰ˆæœ¬çš„è¿­ä»£ã€‚æ¯ä¸€æ­¥éƒ½åŸºäºå¯¹ä¸Šä¸€ç‰ˆæœ¬æ€§èƒ½ç“¶é¢ˆçš„æ·±åˆ»åˆ†æï¼Œå¹¶é‡‡å–äº†é’ˆå¯¹æ€§çš„ä¼˜åŒ–ç­–ç•¥ã€‚

### **V1.0: åŸºå‡†æ¨¡å‹ (Baseline Model)** 

### *   **é…ç½®:** `YOLOv8s`, åŸå§‹æ•°æ®é›†, åŸºç¡€æ•°æ®å¢å¼º, 50 epochs. 

### *   **è¯Šæ–­:** è®­ç»ƒæ›²çº¿æ˜¾ç¤ºï¼Œæ¨¡å‹åœ¨çº¦15è½®åå‡ºç°**ä¸¥é‡è¿‡æ‹Ÿåˆ**ï¼Œæ³›åŒ–èƒ½åŠ›å·®ã€‚

### *   **æœ€ç»ˆæˆç»© (mAP50-95):** **`0.21`**

### **V2.0: æŠ‘åˆ¶è¿‡æ‹Ÿåˆ** 

### *   **ä¼˜åŒ–ç­–ç•¥:** å‡çº§ä¸º`YOLOv8m`ï¼Œå¹¶å¼•å…¥**å¼ºåŠ›æ•°æ®å¢å¼º** (Mosaic, Mixupç­‰) åŠ**æ—©åœæœºåˆ¶** (`patience=20`)ã€‚

### *   **ç»“æœåˆ†æ:** æˆåŠŸæŠ‘åˆ¶è¿‡æ‹Ÿåˆï¼Œä½†æ€§èƒ½æå‡æœ‰é™ã€‚ 

### *   **æœ€ç»ˆæˆç»© (mAP50-95):** **`0.22`**

### **V3.0: æ•°æ®æ¸…æ´— -> æ ‡ç­¾ä½“ç³»â€œæ­£è§„åŒ–â€** 

### *   **è¯Šæ–­:** æ·±å…¥åˆ†æå‘ç°ï¼ŒåŸå§‹æ•°æ®é›†æ ‡ç­¾**æå…¶æ··ä¹±**ï¼Œå­˜åœ¨26ä¸ªé‡å¤ã€å†²çªçš„ç±»åˆ«ã€‚

###  *   **ä¼˜åŒ–ç­–ç•¥:** ç¼–å†™`tools/clean_labels.py`è„šæœ¬ï¼Œå°†26ä¸ªæ··ä¹±ç±»åˆ«ï¼Œç»Ÿä¸€é‡æ–°æ˜ å°„ä¸º`person`, `helmet`, `vest`, `no-helmet` 4ä¸ªæ ¸å¿ƒç±»åˆ«ï¼Œè‡ªåŠ¨æ¸…æ´—å’Œé‡æ˜ å°„äº† **7449** ä¸ªæ ‡æ³¨æ¡†ã€‚ 

### *   **ç»“æœåˆ†æ:** ä½¿ç”¨æ¸…æ´—åçš„æ•°æ®é›†ï¼Œæ¨¡å‹æ€§èƒ½å¾—åˆ°æ˜¾è‘—æå‡ã€‚ *   **æœ€ç»ˆæˆç»© (mAP50-95):** **`0.25`**

### **V4.0: æ•°æ®å‡è¡¡ -> è§£å†³â€œåç§‘â€é—®é¢˜** 

### *   **è¯Šæ–­:** V3.0çš„ç±»åˆ«åˆ†å¸ƒåˆ†ææ˜¾ç¤ºï¼Œ`vest`ç±»åˆ«çš„æ ·æœ¬é‡æ˜¯å…¶ä»–ç±»åˆ«çš„æ•°å€ï¼Œå­˜åœ¨**ä¸¥é‡çš„ç±»åˆ«ä¸å¹³è¡¡**ã€‚ 

### *   **ä¼˜åŒ–ç­–ç•¥:** ç¼–å†™`tools/balance_dataset_v2.py`è„šæœ¬ï¼Œå®ç°æ™ºèƒ½çš„**æ¬ é‡‡æ ·(Undersampling)**ä¸**è¿‡é‡‡æ ·(Oversampling)**ï¼Œå°†`vest`ä¸å…¶ä»–ç±»åˆ«çš„æ ·æœ¬æ¯”ä¾‹ä¼˜åŒ–è‡³å¥åº·çš„`~2:1`ã€‚ 

### *   **æœ€ç»ˆç»“æœåˆ†æ:** **æ€§èƒ½è¿æ¥è´¨çš„é£è·ƒï¼** mAP50-95ä»0.25**æš´åŠ›æ‹‰å‡è‡³ `0.55`**ï¼

**V1.0 -> V4.0 æ ¸å¿ƒæŒ‡æ ‡è¿›åŒ–å²ï¼š**

| ç‰ˆæœ¬     | æ ¸å¿ƒç­–ç•¥     | mAP50     | mAP50-95   |
| -------- | ------------ | --------- | ---------- |
| V1.0     | åŸºå‡†æ¨¡å‹     | ~0.30     | **`0.21`** |
| V2.0     | æŠ‘åˆ¶è¿‡æ‹Ÿåˆ   | ~0.30     | **`0.22`** |
| V3.0     | æ ‡ç­¾æ¸…æ´—     | ~0.40     | **`0.25`** |
| **V4.0** | **æ•°æ®å‡è¡¡** | **~0.85** | **`0.55`** |

**V4.0 "ç‹è€…ä¹‹å¸ˆ" è®­ç»ƒæ›²çº¿å…¨æ™¯å›¾ï¼š**

![V4.0è®­ç»ƒæ›²çº¿](docs/v4_results.png)

---

## ğŸ› ï¸ å¦‚ä½•å¤ç° (How to Reproduce)

### 1. ç¯å¢ƒé…ç½® (Environment Setup) æœ¬é¡¹ç›®åœ¨ä»¥ä¸‹Condaè™šæ‹Ÿç¯å¢ƒä¸­è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼š



# åˆ›å»ºå¹¶æ¿€æ´»Condaç¯å¢ƒ 

conda create --name yolov8_env python=3.9 -y conda activate yolov8_env

# å®‰è£…æ ¸å¿ƒä¾èµ– (PyTorchç‰ˆæœ¬è¯·æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬ä»å®˜ç½‘è·å–)

pip install ultralytics conda install pytorch torchvision torchaudio pytorch-cuda=12.1 -c pytorch -c nvidia

### 2. æ•°æ®é›†å‡†å¤‡ (Dataset Preparation)

æœ¬é¡¹ç›®ä½¿ç”¨çš„å…¬å¼€æ•°æ®é›†ç»è¿‡äº†å¤§é‡çš„æ¸…æ´—å’Œå‡è¡¡åŒ–å¤„ç†ã€‚å¤„ç†è„šæœ¬ä½äºtools/ç›®å½•ä¸‹ã€‚å¤„ç†åçš„æ•°æ®é›†ç»“æ„åº”å¦‚ä¸‹ï¼š

/your_project_root    

â”œâ”€â”€ datasets/    

â”‚   â”œâ”€â”€ train/    

â”‚   â”‚   â”œâ”€â”€ images/    

â”‚   â”‚   â””â”€â”€ labels/   

 â”‚   â””â”€â”€ valid/  

  â”‚       â”œâ”€â”€ images/   

 â”‚       â””â”€â”€ labels/   

 â””â”€â”€ data.yaml

**data.yaml** **é…ç½®æ–‡ä»¶å†…å®¹ï¼š**

train: ./datasets/train/images

 val: ./datasets/valid/images

 nc: 4 

names:  - person  - helmet  - vest  - no-helmet

### 3. æ¨¡å‹è®­ç»ƒ (Training)

å°†ä»¥ä¸‹ä»£ç ä¿å­˜ä¸ºmy_train.pyå¹¶è¿è¡Œ python my_train.pyï¼Œå³å¯å¤ç°V4.0ç‰ˆæœ¬çš„è®­ç»ƒã€‚

import os from ultralytics import YOLO # è§£å†³OMP Error os.environ["KMP_DUPLICATE_LIB_OK"]="TRUE" if __name__ == '__main__':    # åŠ è½½YOLOv8ä¸­å·é¢„è®­ç»ƒæ¨¡å‹    model = YOLO('yolov8m.pt')         # å¯åŠ¨è®­ç»ƒï¼Œå¹¶ä¼ å…¥æ‰€æœ‰ä¼˜åŒ–å‚æ•°    results = model.train(        # åŸºç¡€æŒ‡ä»¤        data='data.yaml',        imgsz=640,                # æ ¸å¿ƒä¼˜åŒ–æŒ‡ä»¤        epochs=100,        patience=20,                # æ•°æ®å¢å¼ºå‚æ•°        degrees=10.0,        translate=0.1,        scale=0.5,        shear=10.0,        perspective=0.001,        flipud=0.5,        fliplr=0.5,                # è®­ç»ƒå‚æ•°        batch=16,        optimizer='AdamW',        lr0=0.01,                # å®éªŒå‘½å        project='runs/detect',        name='experiment_v4_balanced_data'    )

### 4. æ¨¡å‹æ¨ç† (Inference)

ä½¿ç”¨ä½ è®­ç»ƒå¥½çš„æœ€ä½³æƒé‡è¿›è¡Œé¢„æµ‹ï¼š

yolo predict model=runs/detect/experiment_v4_balanced_data/weights/best.pt source='path/to/your/test_image.jpg'

## ğŸ’¡ æ€»ç»“ä¸å±•æœ› (Conclusion & Future Work)

æœ¬é¡¹ç›®æˆåŠŸåœ°åŸºäºYOLOv8æ¡†æ¶ï¼Œå®ç°äº†ä¸€ä¸ªæœ‰æ•ˆçš„PPEæ£€æµ‹ç³»ç»Ÿã€‚æœ€æ ¸å¿ƒçš„æ”¶è·æ˜¯éªŒè¯äº†**æ•°æ®è´¨é‡ï¼ˆæ ‡ç­¾ä¸€è‡´æ€§ã€æ ·æœ¬å‡è¡¡æ€§ï¼‰æ˜¯å†³å®šæ¨¡å‹æ€§èƒ½ä¸Šé™çš„å…³é”®å› ç´ **ã€‚

**æœªæ¥å¯è¡Œçš„ä¼˜åŒ–æ–¹å‘ï¼š**

- **æ•°æ®å±‚é¢ï¼š** é’ˆå¯¹æ€§åœ°è¡¥å……â€œå°ç›®æ ‡â€å’Œâ€œå›°éš¾è´Ÿæ ·æœ¬â€æ•°æ®ã€‚
- **æ¨¡å‹å±‚é¢ï¼š** å°è¯•YOLOv9ç­‰æ›´å…ˆè¿›çš„æ¨¡å‹æ¶æ„ï¼Œæˆ–å¼•å…¥æ³¨æ„åŠ›æœºåˆ¶ç­‰æ¨¡å—ã€‚
- **éƒ¨ç½²å±‚é¢ï¼š** ä½¿ç”¨TensorRTå¯¹æ¨¡å‹è¿›è¡ŒåŠ é€Ÿï¼Œå¹¶å°†å…¶å°è£…ä¸ºAPIæœåŠ¡ã€‚